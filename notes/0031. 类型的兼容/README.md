# [0031. ç±»å‹çš„å…¼å®¹](https://github.com/tnotesjs/TNotes.typescript/tree/main/notes/0031.%20%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%85%BC%E5%AE%B9)

<!-- region:toc -->

- [1. ğŸ¯ æœ¬èŠ‚å†…å®¹](#1--æœ¬èŠ‚å†…å®¹)
- [2. ğŸ«§ è¯„ä»·](#2--è¯„ä»·)
- [3. ğŸ¤” ä»€ä¹ˆæ˜¯ TypeScript ä¸­çš„ç±»å‹å…¼å®¹æ€§ï¼Ÿ](#3--ä»€ä¹ˆæ˜¯-typescript-ä¸­çš„ç±»å‹å…¼å®¹æ€§)
- [4. ğŸ¤” ä»€ä¹ˆæ˜¯ç»“æ„å­ç±»å‹ï¼ˆStructural Typingï¼‰ï¼Ÿ](#4--ä»€ä¹ˆæ˜¯ç»“æ„å­ç±»å‹structural-typing)
- [5. ğŸ¤” TypeScript ä¸­èµ‹å€¼å…¼å®¹æ€§è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ](#5--typescript-ä¸­èµ‹å€¼å…¼å®¹æ€§è§„åˆ™æ˜¯ä»€ä¹ˆ)
- [6. ğŸ¤” å¯¹è±¡ç±»å‹çš„å…¼å®¹æ€§è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ](#6--å¯¹è±¡ç±»å‹çš„å…¼å®¹æ€§è§„åˆ™æ˜¯ä»€ä¹ˆ)
- [7. ğŸ¤” å‡½æ•°ç±»å‹çš„å…¼å®¹æ€§è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ](#7--å‡½æ•°ç±»å‹çš„å…¼å®¹æ€§è§„åˆ™æ˜¯ä»€ä¹ˆ)
- [8. ğŸ¤” æ³›å‹ç±»å‹çš„å…¼å®¹æ€§è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ](#8--æ³›å‹ç±»å‹çš„å…¼å®¹æ€§è§„åˆ™æ˜¯ä»€ä¹ˆ)
- [9. ğŸ¤” ç‰¹æ®Šç±»å‹ä¹‹é—´çš„å…¼å®¹æ€§å¦‚ä½•ï¼Ÿ](#9--ç‰¹æ®Šç±»å‹ä¹‹é—´çš„å…¼å®¹æ€§å¦‚ä½•)
- [10. ğŸ¤” ç±»ç±»å‹çš„å…¼å®¹æ€§è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ](#10--ç±»ç±»å‹çš„å…¼å®¹æ€§è§„åˆ™æ˜¯ä»€ä¹ˆ)
- [11. ğŸ¤” å¦‚ä½•æ£€æŸ¥ç±»å‹å…¼å®¹æ€§ï¼Ÿ](#11--å¦‚ä½•æ£€æŸ¥ç±»å‹å…¼å®¹æ€§)
- [12. ğŸ¤” TypeScript ç±»å‹å…¼å®¹æ€§çš„æœ€ä½³å®è·µæ˜¯ä»€ä¹ˆï¼Ÿ](#12--typescript-ç±»å‹å…¼å®¹æ€§çš„æœ€ä½³å®è·µæ˜¯ä»€ä¹ˆ)
- [13. ğŸ”— å¼•ç”¨](#13--å¼•ç”¨)

<!-- endregion:toc -->

## 1. ğŸ¯ æœ¬èŠ‚å†…å®¹

- ç±»å‹çš„å…¼å®¹æ€§ï¼ˆType Compatibilityï¼‰
- é¸­å­ç±»å‹ï¼ˆDuck Typingï¼‰

## 2. ğŸ«§ è¯„ä»·

- TypeScript çš„ç±»å‹å…¼å®¹æ€§åªé—®"ä½ æœ‰æ²¡æœ‰æˆ‘éœ€è¦çš„ä¸œè¥¿"ï¼Œä¸é—®"ä½ å«ä»€ä¹ˆåå­—"ã€‚

## 3. ğŸ¤” ä»€ä¹ˆæ˜¯ TypeScript ä¸­çš„ç±»å‹å…¼å®¹æ€§ï¼Ÿ

ç±»å‹çš„å…¼å®¹æ€§ï¼ˆType Compatibilityï¼‰æ˜¯ TypeScript ç±»å‹ç³»ç»Ÿçš„æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€ã€‚å®ƒå†³å®šäº†"ä¸€ä¸ªç±»å‹æ˜¯å¦å¯ä»¥èµ‹å€¼ç»™å¦ä¸€ä¸ªç±»å‹"ï¼Œç›´æ¥å½±å“ä»£ç èƒ½å¦é€šè¿‡ç¼–è¯‘ã€‚ç†è§£è¿™ä¸€æœºåˆ¶ï¼Œèƒ½å¸®åŠ©ä½ å†™å‡ºæ›´çµæ´»ã€æ›´å®‰å…¨çš„ä»£ç ï¼Œå¹¶é¿å…å¸¸è§çš„ç±»å‹é”™è¯¯ã€‚

TypeScript çš„ç±»å‹å…¼å®¹æ€§åŸºäºç»“æ„å­ç±»å‹ï¼ˆStructural Subtypingï¼‰ï¼Œè€Œéåƒ Java/C# é‚£æ ·çš„åä¹‰å­ç±»å‹ï¼ˆNominal Subtypingï¼‰ã€‚è¿™æ˜¯ TypeScript ä¸è®¸å¤šä¼ ç»Ÿé¢å‘å¯¹è±¡è¯­è¨€çš„å…³é”®åŒºåˆ«ã€‚

## 4. ğŸ¤” ä»€ä¹ˆæ˜¯ç»“æ„å­ç±»å‹ï¼ˆStructural Typingï¼‰ï¼Ÿ

ç»“æ„å­ç±»å‹çš„æ ¸å¿ƒåŸåˆ™æ˜¯ï¼š"å¦‚æœ A æ‹¥æœ‰ B æ‰€éœ€çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œé‚£ä¹ˆ A å°±å…¼å®¹ Bã€‚"

æ¢å¥è¯è¯´ï¼ŒTypeScript åªå…³å¿ƒç±»å‹çš„ç»“æ„ï¼ˆshapeï¼‰ï¼Œè€Œä¸å…³å¿ƒç±»å‹çš„åç§°æˆ–å£°æ˜æ–¹å¼ã€‚

- ç¤ºä¾‹ 1ï¼šä¸åŒåç§°ï¼Œç›¸åŒç»“æ„ â†’ å…¼å®¹

```ts
interface Point2D {
  x: number
  y: number
}

interface Vector {
  x: number
  y: number
}

const p: Point2D = { x: 1, y: 2 }
const v: Vector = p // âœ… å…¼å®¹ï¼å› ä¸ºç»“æ„ç›¸åŒ
```

- ç¤ºä¾‹ 2ï¼šé¢å¤–å±æ€§ â†’ å…¼å®¹ï¼ˆ"é¸­å­ç±»å‹"ï¼‰

```ts
interface Animal {
  name: string
}

const dog = {
  name: 'Buddy',
  breed: 'Golden Retriever', // é¢å¤–å±æ€§
}

const a: Animal = dog // âœ… å…¼å®¹ï¼dog è‡³å°‘æ»¡è¶³ Animal çš„è¦æ±‚
```

> ğŸ¦† é¸­å­ç±»å‹ï¼ˆDuck Typingï¼‰ï¼š "å¦‚æœå®ƒèµ°èµ·æ¥åƒé¸­å­ï¼Œå«èµ·æ¥åƒé¸­å­ï¼Œé‚£å®ƒå°±æ˜¯é¸­å­ã€‚"

## 5. ğŸ¤” TypeScript ä¸­èµ‹å€¼å…¼å®¹æ€§è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ

TypeScript çš„å…¼å®¹æ€§ä¸»è¦ç”¨äºèµ‹å€¼åœºæ™¯ï¼ˆåŒ…æ‹¬å‡½æ•°å‚æ•°ã€è¿”å›å€¼ã€å˜é‡åˆå§‹åŒ–ç­‰ï¼‰ã€‚

```ts
// ç›®æ ‡ç±»å‹ï¼ˆTargetï¼‰ vs. æºç±»å‹ï¼ˆSourceï¼‰
let target: Target = source // source çš„ç±»å‹å¿…é¡»å…¼å®¹ Target
```

- ç›®æ ‡ç±»å‹ï¼ˆTargetï¼‰ï¼šå˜é‡/å‚æ•°å£°æ˜çš„ç±»å‹
- æºç±»å‹ï¼ˆSourceï¼‰ï¼šå®é™…èµ‹å€¼çš„å€¼çš„ç±»å‹

å…¼å®¹æ¡ä»¶ï¼šæºç±»å‹å¿…é¡»åŒ…å«ç›®æ ‡ç±»å‹çš„æ‰€æœ‰æˆå‘˜ï¼ˆä¸”ç±»å‹å…¼å®¹ï¼‰ã€‚

## 6. ğŸ¤” å¯¹è±¡ç±»å‹çš„å…¼å®¹æ€§è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ

- è§„åˆ™ 1ï¼šæºç±»å‹å¯ä»¥æœ‰é¢å¤–å±æ€§ï¼ˆè¶…é›†å…¼å®¹å­é›†ï¼‰

```ts
type A = { x: number }
type B = { x: number; y: string }

let a: A = { x: 1 }
let b: B = { x: 2, y: 'hello' }

a = b // âœ… B æ˜¯ A çš„è¶…é›†ï¼Œå…¼å®¹
// b = a; // âŒ A ç¼ºå°‘ yï¼Œä¸å…¼å®¹
```

- è§„åˆ™ 2ï¼šå¯¹è±¡å­—é¢é‡çš„"æ–°é²œåº¦æ£€æŸ¥"ï¼ˆFreshness Checkingï¼‰

```ts
let a: A = { x: 1, y: 'extra' } // âŒ é”™è¯¯ï¼å¯¹è±¡å­—é¢é‡ä¸èƒ½æœ‰æœªçŸ¥å±æ€§
```

è¿™æ˜¯ TypeScript çš„é¢å¤–ä¿æŠ¤ï¼šé˜²æ­¢æ‹¼å†™é”™è¯¯ã€‚ä½†å¦‚æœæ˜¯å˜é‡èµ‹å€¼ï¼Œåˆ™å…è®¸ï¼š

```ts
const obj = { x: 1, y: 'extra' }
let a: A = obj // âœ… å…è®¸
```

## 7. ğŸ¤” å‡½æ•°ç±»å‹çš„å…¼å®¹æ€§è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ

å‡½æ•°å…¼å®¹æ€§éµå¾ª"é€†å˜"ï¼ˆContravarianceï¼‰å’Œ"åå˜"ï¼ˆCovarianceï¼‰è§„åˆ™ã€‚

åŸºæœ¬è§„åˆ™ï¼š

- å‚æ•°ç±»å‹ï¼šé€†å˜ â†’ æºå‡½æ•°çš„å‚æ•°ç±»å‹å¯ä»¥æ¯”ç›®æ ‡å‡½æ•°æ›´å®½æ³›
- è¿”å›ç±»å‹ï¼šåå˜ â†’ æºå‡½æ•°çš„è¿”å›ç±»å‹å¯ä»¥æ¯”ç›®æ ‡å‡½æ•°æ›´å…·ä½“

---

- ç¤ºä¾‹ï¼šå‚æ•°é€†å˜

```ts
type Handler = (event: MouseEvent) => void

const handleClick: Handler = (event: Event) => {
  // event æ˜¯ Eventï¼ˆæ¯” MouseEvent æ›´å®½æ³›ï¼‰
  console.log(event.timeStamp)
}

// âœ… å…¼å®¹ï¼å› ä¸º MouseEvent æ˜¯ Event çš„å­ç±»å‹ï¼Œ
// ä¼ å…¥ MouseEvent æ—¶ï¼ŒEvent ç±»å‹çš„å‚æ•°èƒ½å®‰å…¨å¤„ç†å®ƒ
```

- ç¤ºä¾‹ï¼šè¿”å›å€¼åå˜

```ts
type Factory = () => HTMLElement

const createDiv: Factory = () => {
  return document.createElement('div') // HTMLDivElement
}

// âœ… å…¼å®¹ï¼HTMLDivElement æ˜¯ HTMLElement çš„å­ç±»å‹
```

## 8. ğŸ¤” æ³›å‹ç±»å‹çš„å…¼å®¹æ€§è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ

æ³›å‹å…¼å®¹æ€§å–å†³äºç±»å‹å‚æ•°çš„ä½¿ç”¨ä½ç½®ï¼ˆåå˜/é€†å˜/ä¸å˜ï¼‰ã€‚

ç®€å•è§„åˆ™ï¼š

- å¦‚æœæ³›å‹åªç”¨äºè¿”å›å€¼ â†’ åå˜ï¼ˆå­ç±»å‹å…¼å®¹ï¼‰
- å¦‚æœæ³›å‹åªç”¨äºå‚æ•° â†’ é€†å˜ï¼ˆçˆ¶ç±»å‹å…¼å®¹ï¼‰
- å¦‚æœæ³›å‹æ—¢ç”¨äºå‚æ•°åˆç”¨äºè¿”å›å€¼ â†’ ä¸å˜ï¼ˆå¿…é¡»å®Œå…¨ç›¸åŒï¼‰

---

- ç¤ºä¾‹ï¼šæ•°ç»„ï¼ˆåå˜ï¼‰

```ts
let animals: Animal[] = [{ name: 'Lion' }]
let dogs: Dog[] = [{ name: 'Buddy', breed: 'Lab' }]

animals = dogs // âœ… Dog[] å…¼å®¹ Animal[]ï¼ˆå› ä¸º Dog æ˜¯ Animal çš„å­ç±»å‹ï¼‰
```

æ³¨æ„ï¼šè¿™åœ¨å¯å˜æ•°ç»„ä¸­ä¸å®‰å…¨ï¼ˆå¯ä»¥ `animals.push(new Cat())`ï¼‰ï¼Œä½† TypeScript ä»å…è®¸ï¼ˆå‡ºäºå®ç”¨æ€§ï¼‰ã€‚

## 9. ğŸ¤” ç‰¹æ®Šç±»å‹ä¹‹é—´çš„å…¼å®¹æ€§å¦‚ä½•ï¼Ÿ

å›é¡¾ç¬”è®°ã€Œ0017. ç‰¹æ®Šç±»å‹çš„å¯èµ‹å€¼æ€§ã€ä¸­çš„å†…å®¹ï¼š

ğŸ” æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ -> [any, unknown, object, void, undefined, null, and never assignability][1]

|             | any | unknown | object | void | undefined | null | never |
| ----------- | --- | ------- | ------ | ---- | --------- | ---- | ----- |
| any â†’       |     | âœ“       | âœ“      | âœ“    | âœ“         | âœ“    | âœ•     |
| unknown â†’   | âœ“   |         | âœ•      | âœ•    | âœ•         | âœ•    | âœ•     |
| object â†’    | âœ“   | âœ“       |        | âœ•    | âœ•         | âœ•    | âœ•     |
| void â†’      | âœ“   | âœ“       | âœ•      |      | âœ•         | âœ•    | âœ•     |
| undefined â†’ | âœ“   | âœ“       | âœ…     | âœ“    |           | âœ…   | âœ•     |
| null â†’      | âœ“   | âœ“       | âœ…     | âœ…   | âœ…        |      | âœ•     |
| never â†’     | âœ“   | âœ“       | âœ“      | âœ“    | âœ“         | âœ“    |       |

- "âœ…" è¡¨ç¤ºå½“ strictNullChecks å…³é—­æ—¶ï¼Œä¸¤ç§ç±»å‹ä¹‹é—´æ˜¯å…¼å®¹çš„ã€‚
- è¡Œï¼Œä¸»åŠ¨ï¼Œè¡¨ç¤ºè¯¥ç±»å‹å¯ä»¥èµ‹å€¼ç»™å“ªäº›ç±»å‹
- åˆ—ï¼Œè¢«åŠ¨ï¼Œè¡¨ç¤ºè¯¥ç±»å‹å¯ä»¥è¢«å“ªäº›ç±»å‹èµ‹å€¼
- è¡¨æ ¼ä¸­çš„ object ç±»å‹ä»£è¡¨æ‰€æœ‰éåŸå§‹ç±»å‹çš„ç±»å‹ï¼Œå³æ•°ç»„ã€å¯¹è±¡ä¸å‡½æ•°ç±»å‹
- æ¯ä¸ªç±»å‹éƒ½å¯ä»¥èµ‹å€¼ç»™å…¶æœ¬èº«

## 10. ğŸ¤” ç±»ç±»å‹çš„å…¼å®¹æ€§è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ

ç±»ä¹Ÿéµå¾ªç»“æ„å­ç±»å‹ï¼Œä½†ç§æœ‰/å—ä¿æŠ¤æˆå‘˜ä¾‹å¤–ï¼

- å…¬æœ‰æˆå‘˜ï¼šç»“æ„å…¼å®¹

```ts
class Point {
  x: number
  y: number
}
class Vector {
  x: number
  y: number
}

let p: Point = new Vector() // âœ… å…¼å®¹
```

- ç§æœ‰/å—ä¿æŠ¤æˆå‘˜ï¼šå¿…é¡»æ¥è‡ªåŒä¸€å£°æ˜

```ts
class Animal {
  private name: string
  constructor(name: string) {
    this.name = name
  }
}

class Dog {
  private name: string // å³ä½¿ç»“æ„ç›¸åŒï¼Œä¹Ÿä¸æ˜¯ Animal çš„ç§æœ‰æˆå‘˜
  constructor(name: string) {
    this.name = name
  }
}

let a: Animal = new Dog('Buddy') // âŒ é”™è¯¯ï¼ç§æœ‰æˆå‘˜ä¸å…¼å®¹

// åŸå› ï¼šé˜²æ­¢æ„å¤–ç»§æ‰¿ï¼Œä¿è¯å°è£…æ€§ã€‚
```

## 11. ğŸ¤” å¦‚ä½•æ£€æŸ¥ç±»å‹å…¼å®¹æ€§ï¼Ÿ

- ä½¿ç”¨ç±»å‹æ–­è¨€ï¼ˆä¸æ¨èç”¨äºç”Ÿäº§ï¼‰

```ts
// å¼ºåˆ¶è®¤ä¸ºå…¼å®¹ï¼ˆå¯èƒ½è¿è¡Œæ—¶é”™è¯¯ï¼‰
let x = value as Target
```

- ä½¿ç”¨ç±»å‹å®ˆå«ï¼ˆæ¨èï¼‰

```ts
if (isTarget(value)) {
  // value è¢«æ”¶çª„ä¸º Target
}
```

- ä½¿ç”¨å·¥å…·ç±»å‹ `extends`ï¼ˆæ¡ä»¶ç±»å‹ï¼‰

```ts
type IsCompatible<A, B> = A extends B ? true : false
```

## 12. ğŸ¤” TypeScript ç±»å‹å…¼å®¹æ€§çš„æœ€ä½³å®è·µæ˜¯ä»€ä¹ˆï¼Ÿ

1. æ‹¥æŠ±ç»“æ„ç±»å‹ï¼šä¸è¦ä¾èµ–ç±»å‹åç§°ï¼Œå…³æ³¨å¯¹è±¡ç»“æ„ã€‚
2. é¿å… `any`ï¼šç”¨ `unknown` + ç±»å‹å®ˆå«æ›¿ä»£ã€‚
3. ç†è§£å‡½æ•°å…¼å®¹æ€§ï¼šå‚æ•°é€†å˜ã€è¿”å›å€¼åå˜æ˜¯å¸¸è§å›°æƒ‘ç‚¹ã€‚
4. è°¨æ…ä½¿ç”¨å¯å˜æ•°ç»„çš„åå˜ï¼šè€ƒè™‘ç”¨ `ReadonlyArray<T>` æå‡å®‰å…¨æ€§ã€‚
5. åˆ©ç”¨å…¼å®¹æ€§è®¾è®¡çµæ´» APIï¼š

```ts
// æ¥å—ä»»ä½•æœ‰ name å±æ€§çš„å¯¹è±¡
function greet(obj: { name: string }) {
  console.log(`Hello, ${obj.name}`)
}
```

## 13. ğŸ”— å¼•ç”¨

- [any, unknown, object, void, undefined, null, and never assignability][1]

[1]: https://www.typescriptlang.org/docs/handbook/type-compatibility.html#any-unknown-object-void-undefined-null-and-never-assignability
