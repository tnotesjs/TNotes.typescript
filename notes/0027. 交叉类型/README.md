# [0027. äº¤å‰ç±»å‹](https://github.com/tnotesjs/TNotes.typescript/tree/main/notes/0027.%20%E4%BA%A4%E5%8F%89%E7%B1%BB%E5%9E%8B)

<!-- region:toc -->

- [1. ğŸ¯ æœ¬èŠ‚å†…å®¹](#1--æœ¬èŠ‚å†…å®¹)
- [2. ğŸ«§ è¯„ä»·](#2--è¯„ä»·)
- [3. ğŸ¤” ä»€ä¹ˆæ˜¯äº¤å‰ç±»å‹ï¼Ÿ](#3--ä»€ä¹ˆæ˜¯äº¤å‰ç±»å‹)
- [4. ğŸ†š äº¤å‰ç±»å‹ vs. è”åˆç±»å‹](#4--äº¤å‰ç±»å‹-vs-è”åˆç±»å‹)
- [5. ğŸ¤” åŒåå±æ€§å¦‚ä½•å¤„ç†ï¼Ÿ](#5--åŒåå±æ€§å¦‚ä½•å¤„ç†)
- [6. ğŸ¤” å‡½æ•°å¦‚ä½•å¤„ç†ï¼Ÿ](#6--å‡½æ•°å¦‚ä½•å¤„ç†)
- [7. ğŸ¤” äº¤å‰ç±»å‹æœ‰å“ªäº›å…¸å‹åº”ç”¨åœºæ™¯ï¼Ÿ](#7--äº¤å‰ç±»å‹æœ‰å“ªäº›å…¸å‹åº”ç”¨åœºæ™¯)
  - [7.1. æ··å…¥ï¼ˆMixinsï¼‰â€”â€” ç»„åˆè¡Œä¸º](#71-æ··å…¥mixins-ç»„åˆè¡Œä¸º)
  - [7.2. æ‰©å±•æ¥å£ï¼ˆæ¯” `extends` æ›´çµæ´»ï¼‰](#72-æ‰©å±•æ¥å£æ¯”-extends-æ›´çµæ´»)
  - [7.3. é«˜é˜¶å‡½æ•°ä¸æ³›å‹ä¸­çš„çº¦æŸ](#73-é«˜é˜¶å‡½æ•°ä¸æ³›å‹ä¸­çš„çº¦æŸ)
  - [7.4. ä¸å·¥å…·ç±»å‹ç»“åˆï¼ˆå¦‚ `Omit`, `Pick`ï¼‰](#74-ä¸å·¥å…·ç±»å‹ç»“åˆå¦‚-omit-pick)
- [8. ğŸ¤” ä½¿ç”¨äº¤å‰ç±»å‹æ—¶éœ€è¦æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿ](#8--ä½¿ç”¨äº¤å‰ç±»å‹æ—¶éœ€è¦æ³¨æ„å“ªäº›é—®é¢˜)
  - [8.1. åŒåå±æ€§å†²çª](#81-åŒåå±æ€§å†²çª)
  - [8.2. ä¸è¦æ»¥ç”¨äº¤å‰åŸå§‹ç±»å‹](#82-ä¸è¦æ»¥ç”¨äº¤å‰åŸå§‹ç±»å‹)
  - [8.3. äº¤å‰ç±»å‹ â‰  å¯¹è±¡åˆå¹¶](#83-äº¤å‰ç±»å‹--å¯¹è±¡åˆå¹¶)
  - [8.4. å¯è¾¨è¯†è”åˆä¸­æ…ç”¨äº¤å‰](#84-å¯è¾¨è¯†è”åˆä¸­æ…ç”¨äº¤å‰)
- [9. ğŸ¤” äº¤å‰ç±»å‹æœ‰å“ªäº›é«˜çº§æŠ€å·§ï¼Ÿ](#9--äº¤å‰ç±»å‹æœ‰å“ªäº›é«˜çº§æŠ€å·§)
  - [9.1. æ¡ä»¶ç±»å‹ä¸­çš„äº¤å‰](#91-æ¡ä»¶ç±»å‹ä¸­çš„äº¤å‰)
  - [9.2. åˆ›å»º"å¿…å¡«"ç‰ˆæœ¬çš„å¯é€‰å±æ€§](#92-åˆ›å»ºå¿…å¡«ç‰ˆæœ¬çš„å¯é€‰å±æ€§)
  - [9.3. ä¸æ˜ å°„ç±»å‹ç»“åˆ](#93-ä¸æ˜ å°„ç±»å‹ç»“åˆ)

<!-- endregion:toc -->

## 1. ğŸ¯ æœ¬èŠ‚å†…å®¹

- äº¤å‰ç±»å‹ï¼ˆIntersection Typesï¼‰

## 2. ğŸ«§ è¯„ä»·

- äº¤å‰ç±»å‹è®©ä½ èƒ½æŠŠå¤šä¸ªâ€œèƒ½åŠ›æ¥å£â€åƒä¹é«˜ç§¯æœ¨ä¸€æ ·æ‹¼åœ¨ä¸€èµ·ï¼Œæ„å»ºå‡ºåŠŸèƒ½æ›´ä¸°å¯Œçš„ç±»å‹ã€‚

## 3. ğŸ¤” ä»€ä¹ˆæ˜¯äº¤å‰ç±»å‹ï¼Ÿ

äº¤å‰ç±»å‹ï¼ˆIntersection Typesï¼‰æ˜¯ TypeScript ç±»å‹ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ ¸å¿ƒç‰¹æ€§ï¼Œä½¿ç”¨ `&`ï¼ˆä¸ç¬¦å·ï¼‰å°†å¤šä¸ªç±»å‹ç»„åˆåœ¨ä¸€èµ·ï¼Œè¡¨ç¤º"è¯¥å€¼å¿…é¡»åŒæ—¶æ‹¥æœ‰æ‰€æœ‰è¿™äº›ç±»å‹çš„å±æ€§å’Œæ–¹æ³•"ã€‚

å¦‚æœè¯´è”åˆç±»å‹è¡¨è¾¾çš„æ˜¯"æˆ–"ï¼ˆA æˆ– Bï¼‰ï¼Œé‚£ä¹ˆäº¤å‰ç±»å‹è¡¨è¾¾çš„å°±æ˜¯"ä¸"ï¼ˆA ä¸” Bï¼‰â€”â€”å³ä¸€ä¸ªå€¼å¿…é¡»åŒæ—¶æ»¡è¶³å¤šä¸ªç±»å‹çš„å…¨éƒ¨è¦æ±‚ã€‚

åŸºæœ¬è¯­æ³•ï¼šäº¤å‰ç±»å‹ä½¿ç”¨ `&`ï¼ˆä¸ç¬¦å·ï¼‰å°†å¤šä¸ªç±»å‹ç»„åˆåœ¨ä¸€èµ·ã€‚

```ts
// åŸºæœ¬ç”¨æ³•
type A = { x: string }
type B = { y: number }

type C = A & B
// ç­‰ä»·äº { x: string; y: number; }

const obj: C = {
  x: 'hello',
  y: 42,
} // âœ… åˆæ³•

// ----------------------------------------

// å¯¹è±¡ç±»å‹çš„äº¤å‰ï¼ˆæœ€å¸¸è§ï¼‰
interface Name {
  name: string
}

interface Age {
  age: number
}

type Person = Name & Age

const alice: Person = {
  name: 'Alice',
  age: 30,
} // âœ…

// ----------------------------------------

// ä¸åŸå§‹ç±»å‹çš„äº¤å‰ï¼ˆè¾ƒå°‘è§ï¼Œé€šå¸¸æ— æ„ä¹‰ï¼‰
type Strange = string & number // neverï¼ˆå› ä¸ºæ²¡æœ‰å€¼èƒ½åŒæ—¶æ˜¯ string å’Œ numberï¼‰
```

## 4. ğŸ†š äº¤å‰ç±»å‹ vs. è”åˆç±»å‹

| ç‰¹æ€§     | äº¤å‰ç±»å‹ (`A & B`)     | è”åˆç±»å‹ (`A \| B`)        |
| -------- | ---------------------- | -------------------------- |
| é€»è¾‘     | "ä¸”"ï¼ˆåŒæ—¶æ»¡è¶³ï¼‰       | "æˆ–"ï¼ˆæ»¡è¶³å…¶ä¸€ï¼‰           |
| å±æ€§     | åŒ…å« A å’Œ B çš„æ‰€æœ‰å±æ€§ | åªèƒ½è®¿é—® A å’Œ B çš„å…±æœ‰å±æ€§ |
| ç”¨é€”     | ç»„åˆèƒ½åŠ›ï¼ˆMixinsï¼‰     | è¡¨ç¤ºå¤šæ€ï¼ˆçŠ¶æ€ã€å¯é€‰å€¼ï¼‰   |
| å®ä¾‹åŒ–   | éœ€æä¾›æ‰€æœ‰å±æ€§         | åªéœ€æ»¡è¶³ä¸€ç§å½¢æ€           |
| å…¸å‹åœºæ™¯ | æ‰©å±•å¯¹è±¡ã€æ··å…¥         | çŠ¶æ€æœºã€å¯ç©ºå€¼ã€å¤šç±»å‹å‚æ•° |

```ts
type A = { x: string }
type B = { y: number }

// äº¤å‰ç±»å‹ï¼šå¿…é¡»åŒæ—¶æœ‰ x å’Œ y
const c: A & B = { x: 'hi', y: 42 }

// è”åˆç±»å‹ï¼šå¯ä»¥åªæœ‰ x æˆ–åªæœ‰ y
const u1: A | B = { x: 'hi' }
const u2: A | B = { y: 42 }
```

## 5. ğŸ¤” åŒåå±æ€§å¦‚ä½•å¤„ç†ï¼Ÿ

- æƒ…å†µ 1ï¼šå±æ€§ç±»å‹å…¼å®¹ â†’ åˆå¹¶ä¸ºæ›´å…·ä½“çš„ç±»å‹

```ts
type A = { prop: string }
type B = { prop: 'hello' } // "hello" æ˜¯ string çš„å­ç±»å‹

type C = A & B // { prop: "hello" }
```

- æƒ…å†µ 2ï¼šå±æ€§ç±»å‹å†²çª â†’ å¾—åˆ° `never`

```ts
type A = { prop: string }
type B = { prop: number }

type C = A & B // { prop: never } â†’ æ•´ä¸ªç±»å‹å¯èƒ½æ— æ³•å®ä¾‹åŒ–
```

## 6. ğŸ¤” å‡½æ•°å¦‚ä½•å¤„ç†ï¼Ÿ

- å‡½æ•°ä¹Ÿä¼šè¢«åˆå¹¶ï¼Œå®šä¹‰å‡½æ•°æ—¶å¿…é¡»æ»¡è¶³æ‰€æœ‰ç­¾åã€‚

```ts
type Callable1 = (x: string) => void
type Callable2 = (x: number) => void

type Both = Callable1 & Callable2

// âŒ é”™è¯¯å†™æ³•
// const fn: Both = (x: string) => { ... } // âŒ å› ä¸º x ä¹Ÿæœ‰å¯èƒ½æ˜¯ number ç±»å‹
// const fn: Both = (x: number) => { ... } // âŒ å› ä¸º x ä¹Ÿæœ‰å¯èƒ½æ˜¯ string ç±»å‹

// âœ… æ­£ç¡®
// x æ»¡è¶³äº†æ‰€æœ‰çš„ç­¾åã€‚
const fn: Both = (x: string | number) => {
  if (typeof x === 'string') {
    // handle string
  } else {
    // handle number
  }
}

fn('hello') // âœ…
fn(42) // âœ…
```

## 7. ğŸ¤” äº¤å‰ç±»å‹æœ‰å“ªäº›å…¸å‹åº”ç”¨åœºæ™¯ï¼Ÿ

### 7.1. æ··å…¥ï¼ˆMixinsï¼‰â€”â€” ç»„åˆè¡Œä¸º

```ts
interface Flyable {
  fly(): void
}

interface Swimmable {
  swim(): void
}

type Duck = { name: string } & Flyable & Swimmable

class MallardDuck implements Duck {
  name = 'Mallard'
  fly() {
    console.log('Flying!')
  }
  swim() {
    console.log('Swimming!')
  }
}
```

### 7.2. æ‰©å±•æ¥å£ï¼ˆæ¯” `extends` æ›´çµæ´»ï¼‰

```ts
type BaseUser = {
  id: string
  email: string
}

type AdminPermissions = {
  role: 'admin'
  canDelete: boolean
}

// åˆ›å»º AdminUser ç±»å‹
type AdminUser = BaseUser & AdminPermissions

const admin: AdminUser = {
  id: '1',
  email: 'admin@example.com',
  role: 'admin',
  canDelete: true,
}
```

### 7.3. é«˜é˜¶å‡½æ•°ä¸æ³›å‹ä¸­çš„çº¦æŸ

```ts
function extend<T, U>(first: T, second: U): T & U {
  return { ...first, ...second }
}

const person = extend({ name: 'Alice' }, { age: 30 })
// person ç±»å‹ï¼š{ name: string } & { age: number }
```

### 7.4. ä¸å·¥å…·ç±»å‹ç»“åˆï¼ˆå¦‚ `Omit`, `Pick`ï¼‰

```ts
// ä¸ºå¯¹è±¡æ·»åŠ ä¸€ä¸ªå›ºå®šå±æ€§
type WithId<T> = T & { id: string }

type User = { name: string; email: string }
type UserWithId = WithId<User> // { name: string; email: string; id: string }
```

## 8. ğŸ¤” ä½¿ç”¨äº¤å‰ç±»å‹æ—¶éœ€è¦æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿ

### 8.1. åŒåå±æ€§å†²çª

```ts
type X = { a: string };
type Y = { a: number };
type Z = X & Y; // { a: never }

const z: Z = { a: ??? }; // æ— æ³•åˆ›å»ºåˆæ³•å®ä¾‹ï¼
```

### 8.2. ä¸è¦æ»¥ç”¨äº¤å‰åŸå§‹ç±»å‹

```ts
type Bad = string & number // never
```

è¿™æ²¡æœ‰å®é™…æ„ä¹‰ï¼Œå› ä¸ºåŸå§‹ç±»å‹äº’æ–¥ã€‚

### 8.3. äº¤å‰ç±»å‹ â‰  å¯¹è±¡åˆå¹¶

äº¤å‰ç±»å‹æ˜¯ç¼–è¯‘æœŸæ¦‚å¿µï¼Œä¸å¤„ç†è¿è¡Œæ—¶å¯¹è±¡åˆå¹¶é€»è¾‘ï¼š

```ts
function merge<A, B>(a: A, b: B): A & B {
  return { ...a, ...b } // è¿™åªæ˜¯æµ…æ‹·è´ï¼Œå¯èƒ½ä¸¢å¤±æ–¹æ³•æˆ–åŸå‹é“¾
}
```

### 8.4. å¯è¾¨è¯†è”åˆä¸­æ…ç”¨äº¤å‰

åœ¨çŠ¶æ€å»ºæ¨¡ä¸­ï¼Œé€šå¸¸ç”¨è”åˆç±»å‹è€Œéäº¤å‰ç±»å‹ï¼š

```ts
// âœ… æ­£ç¡®ï¼šçŠ¶æ€æ˜¯äº’æ–¥çš„
type State = { type: 'loading' } | { type: 'success'; data: string }

// âŒ é”™è¯¯ï¼šäº¤å‰ç±»å‹è¦æ±‚åŒæ—¶æ»¡è¶³ loading å’Œ success
type WrongState = { type: 'loading' } & { type: 'success'; data: string } // type: never
```

## 9. ğŸ¤” äº¤å‰ç±»å‹æœ‰å“ªäº›é«˜çº§æŠ€å·§ï¼Ÿ

### 9.1. æ¡ä»¶ç±»å‹ä¸­çš„äº¤å‰

```ts
type FlattenIfArray<T> = T extends any[] ? T[number] : T
type Mixed = FlattenIfArray<string[]> & number // string & number â†’ never
```

### 9.2. åˆ›å»º"å¿…å¡«"ç‰ˆæœ¬çš„å¯é€‰å±æ€§

```ts
type RequiredUser = User & { name: string; email: string }
// å¦‚æœ User ä¸­ name æ˜¯å¯é€‰çš„ï¼Œè¿™é‡Œå¼ºåˆ¶å®ƒå¿…é¡»å­˜åœ¨
```

### 9.3. ä¸æ˜ å°„ç±»å‹ç»“åˆ

```ts
type ReadonlyAndPartial<T> = Readonly<T> & Partial<T>
// è™½ç„¶é€»è¾‘ä¸ŠçŸ›ç›¾ï¼Œä½†è¯­æ³•åˆæ³•ï¼ˆå®é™…æ•ˆæœä»¥æ›´ä¸¥æ ¼çš„ä¸ºå‡†ï¼‰
```
